{"ast":null,"code":"function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport ChartComponent from './base/ChartComponent';\nimport d3 from './utils/d3';\nimport defaultData from './defaultData.json';\nimport { interpolate, interpolateHsl, interpolateHcl } from 'd3'; // see docs on https://github.com/reuters-graphics/graphics-atlas-client\n// import AtlasMetadataClient from '@reuters-graphics/graphics-atlas-client';\n// const atlastClient = new AtlasMetadataClient();\n\nconst dateParse = d3.timeParse('%Y-%m-%d');\nconst dateFormat = d3.timeFormat('%b %e');\nconst dateFormat_tt = d3.timeFormat('%B %e');\nconst numberFormat_tt = d3.format(',');\n\nclass CountryLockdownIndicatorStrips extends ChartComponent {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"defaultProps\", {\n      dataParams: {\n        date: 'date',\n        index: 'c1',\n        steps: 2,\n        // stepValue = 0, 1...\n        stepValue: 'flag'\n      },\n      height: 250,\n      margin: {\n        top: 10,\n        right: 10,\n        bottom: 10,\n        left: 10\n      },\n      valign: 'center',\n      // start, center, baseline\n      baseColor: '#ECEFF4',\n      stripColor: {\n        // should be numeric values that are mapped from the data\n        0: '#d1eeea',\n        1: '#ffe47f',\n        2: 'orange',\n        3: '#a50f15'\n      },\n      legendItems: {\n        // should contain items from stripColor\n        'null': 'no data',\n        'stepLegend': {\n          0: 'targeted',\n          1: 'nationwide'\n        },\n        'indexLegend': {\n          0: 'no measures',\n          1: 'recommend closing',\n          2: 'require closing (only some levels or categories, eg just high school, or just public schools)',\n          3: 'require closing all levels'\n        }\n      }\n    });\n\n    _defineProperty(this, \"defaultData\", defaultData);\n  }\n\n  draw() {\n    const data = this.data();\n    const props = this.props();\n    const node = this.selection().node(); // get country details from AtlasClient from ISO-2\n    // props.country = atlastClient.getCountry(props.countryISO2);\n\n    const {\n      width\n    } = node.getBoundingClientRect();\n    const transition = d3.transition().duration(750); // main chart container\n\n    const chartDiv = this.selection().appendSelect('div') // see docs in ./utils/d3.js\n    .attr('class', `CountryLockdownIndicatorStrips`).style('width', `${width}px`).style('height', `auto`).appendSelect('div').style('margin', `${props.margin.top}px ${props.margin.right}px) ${props.margin.bottom}px ${props.margin.left}px)`).style('transform', `translate(${props.margin.left}px, ${props.margin.top}px)`); // set scales\n\n    const yScale = d3.scaleLinear().domain([0, props.dataParams.steps - 1]).range([props.height - props.margin.bottom, props.margin.top]);\n    const xScale = d3.scaleBand().domain(data.map(d => dateParse(d[props.dataParams.date]))).range([props.margin.left, width - props.margin.right]).padding(0);\n    const colorDomain = props.stripColor ? Object.keys(props.stripColor).map(d => +d) : d3.extent(data.map(d => d[props.dataParams.index]));\n    const colorRange = props.stripColor ? colorDomain.map(d => props.stripColor[`${d}`]) : ['#cccccc', '#333333'];\n    const colorScale = d3.scaleLinear().domain(colorDomain).range(colorRange).interpolate(interpolateHcl); // make bars\n\n    const bars = chartDiv.appendSelect('div.bars-container').style('display', 'flex').style('align-items', `${props.valign}`).selectAll('.bar').data(data, (d, i) => d[props.dataParams.date]); // for smooth data updation\n\n    const stripheight = props.legendItems ? (props.height - props.margin.top - props.margin.bottom) * 0.2 : props.height - props.margin.top - props.margin.bottom;\n    bars.enter().append('div').attr('class', d => `bar ${d[props.dataParams.date]}`).style('display', 'inline-block').style('height', d => {\n      const stepSize = stripheight / props.dataParams.steps;\n      const step = d[props.dataParams.stepValue] + 1;\n      return d[props.dataParams.index] ? step ? step * stepSize + 'px' : stepSize + 'px' : stepSize + 'px';\n    }).style('width', xScale.bandwidth() + 'px').style('background', d => {\n      let val = parseFloat(d[props.dataParams.index]);\n      return val !== null && !isNaN(val) ? colorScale(val) : props.baseColor;\n    }).merge(bars).transition(transition).style('display', 'inline-block').style('height', d => {\n      const stepSize = stripheight / props.dataParams.steps;\n      const step = d[props.dataParams.stepValue] + 1;\n      return d[props.dataParams.index] ? step ? step * stepSize + 'px' : stepSize + 'px' : stepSize + 'px';\n    }).style('width', xScale.bandwidth() + 'px').style('background', d => {\n      let val = parseFloat(d[props.dataParams.index]);\n      return val !== null && !isNaN(val) ? colorScale(val) : props.baseColor;\n    });\n    bars.exit().transition(transition).attr('height', 0).remove();\n\n    if (props.legendItems) {\n      const indexLegendItems = [];\n      Object.keys(props.legendItems.indexLegend).forEach(d => {\n        let item = {\n          key: d,\n          value: props.legendItems.indexLegend[d]\n        };\n        indexLegendItems.push(item);\n      });\n\n      if (props.legendItems['null']) {\n        indexLegendItems.push({\n          key: 'null',\n          value: props.legendItems['null']\n        });\n      }\n\n      const legendWidth = (width - props.margin.right - props.margin.left) / indexLegendItems.length;\n      console.log(indexLegendItems); // make legend\n\n      const indexLegend = chartDiv.appendSelect('div.legend-container') // .style('align-items', `${props.valign}`)\n      .selectAll('.legend-div').data(indexLegendItems); // for smooth data updation\n\n      indexLegend.enter().append('div').attr('class', `legend-div indexLegend`).style('display', 'flex').style('align-items', `start`) // .style('width', `${legendWidth}px`)\n      .html(d => {\n        let color = +d.key !== null && !isNaN(+d.key) ? props.stripColor[+d.key] : props.baseColor;\n        return `<span style=\"width:1rem; height:1rem;min-width:1rem; min-height:1rem; background: ${color}\"></span> <p style=\"margin:0 0 0 0.5rem;\">${d.value}</p>`;\n      }).merge(indexLegend) // .style('width', `${legendWidth}px`)\n      .html(d => {\n        let color = +d.key !== null && !isNaN(+d.key) ? props.stripColor[+d.key] : props.baseColor;\n        return `<span style=\"width:1rem; height:1rem;min-width:1rem; min-height:1rem; background: ${color}\"></span> <p style=\"margin:0 0 0 0.5rem;\">${d.value}</p>`;\n      });\n      indexLegend.exit().transition(transition).remove();\n    }\n\n    return this;\n  }\n\n} // console.log(this.defaultProps);\n\n\nexport default CountryLockdownIndicatorStrips;","map":{"version":3,"sources":["/Users/prasanta/ReutersWork/INTERACTIVES/COVID-APP/chart-module-CountryLockdownIndicatorStrips/src/lib/chart.js"],"names":["ChartComponent","d3","defaultData","interpolate","interpolateHsl","interpolateHcl","dateParse","timeParse","dateFormat","timeFormat","dateFormat_tt","numberFormat_tt","format","CountryLockdownIndicatorStrips","dataParams","date","index","steps","stepValue","height","margin","top","right","bottom","left","valign","baseColor","stripColor","legendItems","draw","data","props","node","selection","width","getBoundingClientRect","transition","duration","chartDiv","appendSelect","attr","style","yScale","scaleLinear","domain","range","xScale","scaleBand","map","d","padding","colorDomain","Object","keys","extent","colorRange","colorScale","bars","selectAll","i","stripheight","enter","append","stepSize","step","bandwidth","val","parseFloat","isNaN","merge","exit","remove","indexLegendItems","indexLegend","forEach","item","key","value","push","legendWidth","length","console","log","html","color"],"mappings":"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","sourcesContent":["import ChartComponent from './base/ChartComponent';\nimport d3 from './utils/d3';\nimport defaultData from './defaultData.json';\nimport { interpolate, interpolateHsl, interpolateHcl } from 'd3';\n// see docs on https://github.com/reuters-graphics/graphics-atlas-client\n// import AtlasMetadataClient from '@reuters-graphics/graphics-atlas-client';\n// const atlastClient = new AtlasMetadataClient();\n\nconst dateParse = d3.timeParse('%Y-%m-%d');\nconst dateFormat = d3.timeFormat('%b %e');\nconst dateFormat_tt = d3.timeFormat('%B %e');\nconst numberFormat_tt = d3.format(',');\n\nclass CountryLockdownIndicatorStrips extends ChartComponent {\n    defaultProps = {\n        dataParams: {\n            date: 'date',\n            index: 'c1',\n            steps: 2, // stepValue = 0, 1...\n            stepValue: 'flag',\n        },\n        height: 250,\n        margin: {\n            top: 10,\n            right: 10,\n            bottom: 10,\n            left: 10,\n        },\n        valign: 'center', // start, center, baseline\n        baseColor: '#ECEFF4',\n        stripColor: { // should be numeric values that are mapped from the data\n            0: '#d1eeea',\n            1: '#ffe47f',\n            2: 'orange',\n            3: '#a50f15',\n        },\n        legendItems: { // should contain items from stripColor\n            'null': 'no data',\n            'stepLegend': {\n                0: 'targeted',\n                1: 'nationwide'\n            },\n            'indexLegend': {\n                0: 'no measures',\n                1: 'recommend closing',\n                2: 'require closing (only some levels or categories, eg just high school, or just public schools)',\n                3: 'require closing all levels'\n            },\n        }\n    };\n\n    defaultData = defaultData;\n\n    draw() {\n        const data = this.data();\n        const props = this.props();\n        const node = this.selection().node();\n\n        // get country details from AtlasClient from ISO-2\n        // props.country = atlastClient.getCountry(props.countryISO2);\n\n        const {\n            width\n        } = node.getBoundingClientRect();\n\n        const transition = d3.transition()\n            .duration(750);\n\n        // main chart container\n        const chartDiv = this.selection()\n            .appendSelect('div') // see docs in ./utils/d3.js\n            .attr('class', `CountryLockdownIndicatorStrips`)\n            .style('width', `${width}px`)\n            .style('height', `auto`)\n            .appendSelect('div')\n            .style('margin', `${props.margin.top}px ${props.margin.right}px) ${props.margin.bottom}px ${props.margin.left}px)`)\n            .style('transform', `translate(${props.margin.left}px, ${props.margin.top}px)`);\n\n        // set scales\n        const yScale = d3.scaleLinear()\n            .domain([0, props.dataParams.steps - 1])\n            .range([props.height - props.margin.bottom, props.margin.top]);\n\n        const xScale = d3.scaleBand()\n            .domain(data.map(d => dateParse(d[props.dataParams.date])))\n            .range([props.margin.left, width - props.margin.right])\n            .padding(0);\n\n        const colorDomain = props.stripColor ? (Object.keys(props.stripColor)).map(d => +d) : d3.extent(data.map(d => d[props.dataParams.index]));\n\n        const colorRange = props.stripColor ? colorDomain.map(d => props.stripColor[`${d}`]) : ['#cccccc', '#333333']\n\n        const colorScale = d3.scaleLinear()\n            .domain(colorDomain)\n            .range(colorRange)\n            .interpolate(interpolateHcl);\n\n        // make bars\n        const bars = chartDiv.appendSelect('div.bars-container')\n            .style('display', 'flex')\n            .style('align-items', `${props.valign}`)\n            .selectAll('.bar')\n            .data(data, (d, i) => d[props.dataParams.date]); // for smooth data updation\n\n        const stripheight = props.legendItems ? (props.height - props.margin.top - props.margin.bottom) * 0.2 : (props.height - props.margin.top - props.margin.bottom);\n\n        bars.enter().append('div')\n            .attr('class', d => `bar ${d[props.dataParams.date]}`)\n            .style('display', 'inline-block')\n            .style('height', d => {\n                const stepSize = (stripheight) / props.dataParams.steps;\n                const step = d[props.dataParams.stepValue] + 1;\n                return d[props.dataParams.index] ? (step ? step * stepSize + 'px' : stepSize + 'px') : stepSize + 'px';\n            })\n            .style('width', xScale.bandwidth() + 'px')\n            .style('background', d => {\n                let val = parseFloat(d[props.dataParams.index]);\n                return (val !== null) && !(isNaN(val)) ? colorScale(val) : props.baseColor;\n            })\n            .merge(bars)\n            .transition(transition)\n            .style('display', 'inline-block')\n            .style('height', d => {\n                const stepSize = (stripheight) / props.dataParams.steps;\n                const step = d[props.dataParams.stepValue] + 1;\n                return d[props.dataParams.index] ? (step ? step * stepSize + 'px' : stepSize + 'px') : stepSize + 'px';\n            })\n            .style('width', xScale.bandwidth() + 'px')\n            .style('background', d => {\n                let val = parseFloat(d[props.dataParams.index]);\n                return (val !== null) && !(isNaN(val)) ? colorScale(val) : props.baseColor;\n            });\n\n        bars.exit()\n            .transition(transition)\n            .attr('height', 0)\n            .remove();\n\n\n        if (props.legendItems) {\n            const indexLegendItems = [];\n            (Object.keys(props.legendItems.indexLegend)).forEach(d => {\n                let item = {\n                    key: d,\n                    value: props.legendItems.indexLegend[d]\n                }\n                indexLegendItems.push(item);\n            });\n            if (props.legendItems['null']) {\n                indexLegendItems.push({\n                    key: 'null',\n                    value: props.legendItems['null']\n                })\n            }\n            const legendWidth = (width - props.margin.right - props.margin.left) / indexLegendItems.length;\n            console.log(indexLegendItems)\n                // make legend\n            const indexLegend = chartDiv.appendSelect('div.legend-container')\n                // .style('align-items', `${props.valign}`)\n                .selectAll('.legend-div')\n                .data(indexLegendItems); // for smooth data updation\n\n            indexLegend.enter().append('div')\n                .attr('class', `legend-div indexLegend`)\n                .style('display', 'flex')\n                .style('align-items', `start`)\n                // .style('width', `${legendWidth}px`)\n                .html(d => {\n                    let color = (+d.key !== null) && !(isNaN(+d.key)) ? props.stripColor[+d.key] : props.baseColor;\n                    return `<span style=\"width:1rem; height:1rem;min-width:1rem; min-height:1rem; background: ${color}\"></span> <p style=\"margin:0 0 0 0.5rem;\">${d.value}</p>`\n                })\n                .merge(indexLegend)\n                // .style('width', `${legendWidth}px`)\n                .html(d => {\n                    let color = (+d.key !== null) && !(isNaN(+d.key)) ? props.stripColor[+d.key] : props.baseColor;\n                    return `<span style=\"width:1rem; height:1rem;min-width:1rem; min-height:1rem; background: ${color}\"></span> <p style=\"margin:0 0 0 0.5rem;\">${d.value}</p>`\n                });\n\n            indexLegend.exit()\n                .transition(transition)\n                .remove();\n\n\n        }\n        return this;\n    }\n}\n// console.log(this.defaultProps);\nexport default CountryLockdownIndicatorStrips;"]},"metadata":{},"sourceType":"module"}