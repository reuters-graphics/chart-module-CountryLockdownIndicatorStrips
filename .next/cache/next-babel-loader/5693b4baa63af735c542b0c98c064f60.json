{"ast":null,"code":"function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n/* eslint-disable no-trailing-spaces */\nimport ChartComponent from './base/ChartComponent';\nimport d3 from './utils/d3';\nimport { getDates, round } from './utils/utils';\nimport defaultData from './defaultData.json';\nimport { interpolateHcl } from 'd3';\nimport d3SelectionMulti from 'd3-selection-multi'; // see docs on https://github.com/reuters-graphics/graphics-atlas-client\n// import AtlasMetadataClient from '@reuters-graphics/graphics-atlas-client';\n// const atlastClient = new AtlasMetadataClient();\n\nconst dateParse = d3.timeParse('%Y-%m-%d');\nconst dateFormat = d3.timeFormat('%b %e');\nconst dateFormat_tt = d3.timeFormat('%B %e');\nconst numberFormat_tt = d3.format(',');\n\nclass CountryLockdownIndicatorStrips extends ChartComponent {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"defaultProps\", {\n      dateSeries: ['2019-12-31', '2020-07-10'],\n      // 2020-01-31\n      dataParams: {\n        date: 'date',\n        index: 'c1',\n        steps: 2,\n        // stepValue = 0, 1...\n        stepValue: 'flag'\n      },\n      height: 150,\n      stripHeight: 50,\n      margin: {\n        top: 10,\n        right: 0,\n        bottom: 10,\n        left: 0\n      },\n      valign: 'center',\n      // start, center, baseline\n      baseColor: '#ECEFF4',\n      stripColor: {\n        // should be numeric values that are mapped from the data\n        0: '#d1eeea',\n        1: '#ffe47f',\n        2: 'orange',\n        3: '#a50f15'\n      },\n      legendItems: {\n        // should contain items from stripColor\n        null: 'no data',\n        stepLegend: {\n          0: 'targeted',\n          1: 'nationwide'\n        },\n        indexLegend: {\n          0: 'no measures',\n          1: 'recommend closing',\n          2: 'require closing on some levels',\n          3: 'require closing all levels'\n        }\n      }\n    });\n\n    _defineProperty(this, \"defaultData\", defaultData);\n  }\n\n  draw() {\n    let allData = this.data();\n    const props = this.props();\n    const node = this.selection().node();\n\n    if (!props.dateSeries) {\n      props.dateSeries = [dateParse(allData[0].date), dateParse(allData[allData.length - 1].date)];\n    }\n\n    const dateSeries = getDates(props.dateSeries[0], props.dateSeries[1]);\n    allData = allData.map(d => dateParse(d.date)); // set data for the date series\n\n    const data = dateSeries.map(d => {\n      const match = allData.find(e => e.date === d);\n\n      if (match) {\n        return match;\n      }\n    });\n    console.log(allData); // get country details from AtlasClient from ISO-2\n    // props.country = atlastClient.getCountry(props.countryISO2);\n\n    const {\n      width\n    } = node.getBoundingClientRect();\n    const transition = d3.transition().duration(750); // main chart container\n\n    const chartDiv = this.selection().appendSelect('div') // see docs in ./utils/d3.js\n    .attr('class', 'CountryLockdownIndicatorStrips').style('width', `${width}px`) // .style('height', `${props.height}px`)\n    .appendSelect('div').styles({\n      'padding-top': `${props.margin.top}px`,\n      'padding-right': `${props.margin.right}px`,\n      'padding-bottom': `${props.margin.bottom}px`,\n      'padding-left': `${props.margin.left}px`\n    });\n    const stripheight = props.legendItems ? props.stripHeight - props.margin.top : props.height - props.margin.top - props.margin.bottom; // set scales\n\n    const yScale = d3.scaleLinear().domain([0, props.dataParams.steps - 1]).range([stripheight, props.margin.top]);\n    const xScale = d3.scaleBand().domain(dateSeries).range([props.margin.left, width - props.margin.right]).padding(0);\n    const colorDomain = props.stripColor ? Object.keys(props.stripColor).map(d => +d) : d3.extent(data.map(d => d[props.dataParams.index]));\n    const colorRange = props.stripColor ? colorDomain.map(d => props.stripColor[`${d}`]) : ['#cccccc', '#333333'];\n    const colorScale = d3.scaleLinear().domain(colorDomain).range(colorRange).interpolate(interpolateHcl); // make bars\n\n    const bars = chartDiv.appendSelect('div.bars-container').styles({\n      display: 'flex',\n      'align-items': `${props.valign}`\n    }).selectAll('.bar').data(data, (d, i) => d[props.dataParams.date]); // for smooth data updation\n\n    bars.enter().append('div').attr('class', d => `bar ${d[props.dataParams.date]}`).style('display', 'inline-block').style('height', d => {\n      const stepSize = stripheight / props.dataParams.steps;\n      const step = d[props.dataParams.stepValue] + 1;\n      return d[props.dataParams.index] ? step ? step * stepSize + 'px' : stepSize + 'px' : stepSize + 'px';\n    }).style('width', xScale.bandwidth() + 'px').style('background', d => {\n      const val = parseFloat(d[props.dataParams.index]);\n      return val !== null && !isNaN(val) ? colorScale(val) : props.baseColor;\n    }).merge(bars).transition(transition).style('display', 'inline-block').style('height', d => {\n      const stepSize = stripheight / props.dataParams.steps;\n      const step = d[props.dataParams.stepValue] + 1;\n      return d[props.dataParams.index] ? step ? step * stepSize + 'px' : stepSize + 'px' : stepSize + 'px';\n    }).style('width', xScale.bandwidth() + 'px').style('background', d => {\n      const val = parseFloat(d[props.dataParams.index]);\n      return val !== null && !isNaN(val) ? colorScale(val) : props.baseColor;\n    });\n    bars.exit().transition(transition).attr('height', 0).remove();\n\n    if (props.legendItems) {\n      const indexLegendItems = [];\n      Object.keys(props.legendItems.indexLegend).forEach(d => {\n        const item = {\n          key: d,\n          value: props.legendItems.indexLegend[d]\n        };\n        indexLegendItems.push(item);\n      });\n\n      if (props.legendItems.null) {\n        indexLegendItems.push({\n          key: 'null',\n          value: props.legendItems.null\n        });\n      }\n\n      const legendWidth = (width - props.margin.right - props.margin.left) / indexLegendItems.length; // make legend\n\n      const legendDiv = chartDiv.appendSelect('div.legend-container');\n      const indexLegend = legendDiv.appendSelect('div.legend.indexLegend') // .style('align-items', `${props.valign}`)\n      .selectAll('.legend-item').data(indexLegendItems); // for smooth data updation\n\n      indexLegend.enter().append('div').attr('class', 'legend-item').styles({\n        display: 'flex',\n        'align-items': 'start'\n      }) // .style('width', `${legendWidth}px`)\n      .html(d => {\n        const color = +d.key !== null && !isNaN(+d.key) ? props.stripColor[+d.key] : props.baseColor;\n        return `<span style=\"width:1rem; height:1rem;min-width:1rem; min-height:1rem; background: ${color}\"></span> <p style=\"margin:0 0 0 0.5rem;\">${d.value}</p>`;\n      }).merge(indexLegend).styles({\n        display: 'flex',\n        'align-items': 'start'\n      }).style('width', `${legendWidth}px`).html(d => {\n        const color = +d.key !== null && !isNaN(+d.key) ? props.stripColor[+d.key] : props.baseColor;\n        return `<span style=\"width:1rem; height:1rem;min-width:1rem; min-height:1rem; background: ${color}\"></span> <p style=\"margin:0 0 0 0.5rem;\">${d.value}</p>`;\n      });\n      indexLegend.exit().transition(transition).remove();\n\n      if (props.legendItems.stepLegend) {\n        // step legend stuff\n        const stepLegendItems = [];\n        Object.keys(props.legendItems.stepLegend).forEach(d => {\n          const item = {\n            key: d,\n            value: props.legendItems.stepLegend[d]\n          };\n          stepLegendItems.push(item);\n        });\n        console.log(stepLegendItems);\n        const stepLegend = legendDiv.appendSelect('div.legend.stepLegend').selectAll('.legend-item').data(stepLegendItems); // for smooth data updation\n\n        stepLegend.enter().append('div').attr('class', 'legend-item').styles({\n          display: 'flex',\n          'align-items': 'center'\n        }).html((d, i) => {\n          const stepSize = stripheight / stepLegendItems.length;\n          return `<span style=\"width:${8}px; height:${(+d.key + 1) * stepSize}px; background:transparent; border: 0.5px solid #333333;\"></span><p style=\"margin:0 0 0 0.5rem;\">${d.value}</p>`;\n        }).merge(stepLegend).styles({\n          display: 'flex',\n          'align-items': 'center'\n        }).html((d, i) => {\n          const stepSize = stripheight / stepLegendItems.length;\n          return `<span style=\"width:${8}px; height:${(+d.key + 1) * stepSize}px; background:transparent; border: 0.5px solid #333333;\"></span><p style=\"margin:0 0 0 0.5rem;\">${d.value}</p>`;\n        });\n        stepLegend.exit().transition(transition).remove();\n      }\n    }\n\n    return this;\n  }\n\n} // console.log(this.defaultProps);\n\n\nexport default CountryLockdownIndicatorStrips;","map":{"version":3,"sources":["/Users/prasanta/ReutersWork/INTERACTIVES/COVID-APP/chart-module-CountryLockdownIndicatorStrips/src/lib/chart.js"],"names":["ChartComponent","d3","getDates","round","defaultData","interpolateHcl","d3SelectionMulti","dateParse","timeParse","dateFormat","timeFormat","dateFormat_tt","numberFormat_tt","format","CountryLockdownIndicatorStrips","dateSeries","dataParams","date","index","steps","stepValue","height","stripHeight","margin","top","right","bottom","left","valign","baseColor","stripColor","legendItems","null","stepLegend","indexLegend","draw","allData","data","props","node","selection","length","map","d","match","find","e","console","log","width","getBoundingClientRect","transition","duration","chartDiv","appendSelect","attr","style","styles","stripheight","yScale","scaleLinear","domain","range","xScale","scaleBand","padding","colorDomain","Object","keys","extent","colorRange","colorScale","interpolate","bars","display","selectAll","i","enter","append","stepSize","step","bandwidth","val","parseFloat","isNaN","merge","exit","remove","indexLegendItems","forEach","item","key","value","push","legendWidth","legendDiv","html","color","stepLegendItems"],"mappings":"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","sourcesContent":["/* eslint-disable no-trailing-spaces */\nimport ChartComponent from './base/ChartComponent';\nimport d3 from './utils/d3';\nimport { getDates, round } from './utils/utils';\nimport defaultData from './defaultData.json';\nimport { interpolateHcl } from 'd3';\nimport d3SelectionMulti from 'd3-selection-multi';\n// see docs on https://github.com/reuters-graphics/graphics-atlas-client\n// import AtlasMetadataClient from '@reuters-graphics/graphics-atlas-client';\n// const atlastClient = new AtlasMetadataClient();\n\nconst dateParse = d3.timeParse('%Y-%m-%d');\nconst dateFormat = d3.timeFormat('%b %e');\nconst dateFormat_tt = d3.timeFormat('%B %e');\nconst numberFormat_tt = d3.format(',');\n\nclass CountryLockdownIndicatorStrips extends ChartComponent {\n    defaultProps = {\n      dateSeries: ['2019-12-31', '2020-07-10'], // 2020-01-31\n      dataParams: {\n        date: 'date',\n        index: 'c1',\n        steps: 2, // stepValue = 0, 1...\n        stepValue: 'flag',\n      },\n      height: 150,\n      stripHeight: 50,\n      margin: {\n        top: 10,\n        right: 0,\n        bottom: 10,\n        left: 0,\n      },\n      valign: 'center', // start, center, baseline\n      baseColor: '#ECEFF4',\n      stripColor: { // should be numeric values that are mapped from the data\n        0: '#d1eeea',\n        1: '#ffe47f',\n        2: 'orange',\n        3: '#a50f15',\n      },\n      legendItems: { // should contain items from stripColor\n        null: 'no data',\n        stepLegend: {\n          0: 'targeted',\n          1: 'nationwide',\n        },\n        indexLegend: {\n          0: 'no measures',\n          1: 'recommend closing',\n          2: 'require closing on some levels',\n          3: 'require closing all levels',\n        },\n      },\n    };\n\n    defaultData = defaultData;\n\n    draw() {\n      let allData = this.data();\n      const props = this.props();\n      const node = this.selection().node();\n\n      if (!props.dateSeries) {\n        props.dateSeries = [dateParse(allData[0].date), dateParse(allData[allData.length - 1].date)];\n      }\n      const dateSeries = getDates(props.dateSeries[0], props.dateSeries[1]);       \n      \n      allData = allData.map(d => dateParse(d.date));\n      // set data for the date series\n      const data = dateSeries.map(d => {\n        const match = allData.find(e => (e.date) === (d));\n        if (match) {\n          return match;\n        }\n      }); \n\n      console.log(allData);\n      // get country details from AtlasClient from ISO-2\n      // props.country = atlastClient.getCountry(props.countryISO2);\n\n      const {\n        width,\n      } = node.getBoundingClientRect();\n\n      const transition = d3.transition()\n        .duration(750);\n\n      // main chart container\n      const chartDiv = this.selection()\n        .appendSelect('div') // see docs in ./utils/d3.js\n        .attr('class', 'CountryLockdownIndicatorStrips')\n        .style('width', `${width}px`)\n      // .style('height', `${props.height}px`)\n        .appendSelect('div')\n        .styles({\n          'padding-top': `${props.margin.top}px`,\n          'padding-right': `${props.margin.right}px`,\n          'padding-bottom': `${props.margin.bottom}px`,\n          'padding-left': `${props.margin.left}px`,\n        });\n\n      const stripheight = props.legendItems ? (props.stripHeight - props.margin.top) : (props.height - props.margin.top - props.margin.bottom);\n\n      // set scales\n      const yScale = d3.scaleLinear()\n        .domain([0, props.dataParams.steps - 1])\n        .range([stripheight, props.margin.top]);\n\n      const xScale = d3.scaleBand()\n        .domain(dateSeries)\n        .range([props.margin.left, width - props.margin.right])\n        .padding(0);\n\n      const colorDomain = props.stripColor ? (Object.keys(props.stripColor)).map(d => +d) : d3.extent(data.map(d => d[props.dataParams.index]));\n\n      const colorRange = props.stripColor ? colorDomain.map(d => props.stripColor[`${d}`]) : ['#cccccc', '#333333'];\n\n      const colorScale = d3.scaleLinear()\n        .domain(colorDomain)\n        .range(colorRange)\n        .interpolate(interpolateHcl);\n\n      // make bars\n      const bars = chartDiv.appendSelect('div.bars-container')\n        .styles({\n          display: 'flex',\n          'align-items': `${props.valign}`,\n        })\n        .selectAll('.bar')\n        .data(data, (d, i) => d[props.dataParams.date]); // for smooth data updation\n\n      bars.enter().append('div')\n        .attr('class', d => `bar ${d[props.dataParams.date]}`)\n        .style('display', 'inline-block')\n        .style('height', d => {\n          const stepSize = (stripheight) / props.dataParams.steps;\n          const step = d[props.dataParams.stepValue] + 1;\n          return d[props.dataParams.index] ? (step ? step * stepSize + 'px' : stepSize + 'px') : stepSize + 'px';\n        })\n        .style('width', xScale.bandwidth() + 'px')\n        .style('background', d => {\n          const val = parseFloat(d[props.dataParams.index]);\n          return (val !== null) && !(isNaN(val)) ? colorScale(val) : props.baseColor;\n        })\n        .merge(bars)\n        .transition(transition)\n        .style('display', 'inline-block')\n        .style('height', d => {\n          const stepSize = (stripheight) / props.dataParams.steps;\n          const step = d[props.dataParams.stepValue] + 1;\n          return d[props.dataParams.index] ? (step ? step * stepSize + 'px' : stepSize + 'px') : stepSize + 'px';\n        })\n        .style('width', xScale.bandwidth() + 'px')\n        .style('background', d => {\n          const val = parseFloat(d[props.dataParams.index]);\n          return (val !== null) && !(isNaN(val)) ? colorScale(val) : props.baseColor;\n        });\n\n      bars.exit()\n        .transition(transition)\n        .attr('height', 0)\n        .remove();\n\n      if (props.legendItems) {\n        const indexLegendItems = [];\n        (Object.keys(props.legendItems.indexLegend)).forEach(d => {\n          const item = {\n            key: d,\n            value: props.legendItems.indexLegend[d],\n          };\n          indexLegendItems.push(item);\n        });\n        if (props.legendItems.null) {\n          indexLegendItems.push({\n            key: 'null',\n            value: props.legendItems.null,\n          });\n        }\n        const legendWidth = (width - props.margin.right - props.margin.left) / indexLegendItems.length;\n\n        // make legend\n        const legendDiv = chartDiv.appendSelect('div.legend-container');\n\n        const indexLegend = legendDiv.appendSelect('div.legend.indexLegend')\n        // .style('align-items', `${props.valign}`)\n          .selectAll('.legend-item')\n          .data(indexLegendItems); // for smooth data updation\n\n        indexLegend.enter().append('div')\n          .attr('class', 'legend-item')\n          .styles({\n            display: 'flex',\n            'align-items': 'start',\n          })\n        // .style('width', `${legendWidth}px`)\n          .html(d => {\n            const color = (+d.key !== null) && !(isNaN(+d.key)) ? props.stripColor[+d.key] : props.baseColor;\n            return `<span style=\"width:1rem; height:1rem;min-width:1rem; min-height:1rem; background: ${color}\"></span> <p style=\"margin:0 0 0 0.5rem;\">${d.value}</p>`;\n          })\n          .merge(indexLegend)\n          .styles({\n            display: 'flex',\n            'align-items': 'start',\n          })\n          .style('width', `${legendWidth}px`)\n          .html(d => {\n            const color = (+d.key !== null) && !(isNaN(+d.key)) ? props.stripColor[+d.key] : props.baseColor;\n            return `<span style=\"width:1rem; height:1rem;min-width:1rem; min-height:1rem; background: ${color}\"></span> <p style=\"margin:0 0 0 0.5rem;\">${d.value}</p>`;\n          });\n\n        indexLegend.exit()\n          .transition(transition)\n          .remove();\n\n        if (props.legendItems.stepLegend) {\n          // step legend stuff\n          const stepLegendItems = [];\n          (Object.keys(props.legendItems.stepLegend)).forEach(d => {\n            const item = {\n              key: d,\n              value: props.legendItems.stepLegend[d],\n            };\n            stepLegendItems.push(item);\n          });\n          console.log(stepLegendItems);\n\n          const stepLegend = legendDiv.appendSelect('div.legend.stepLegend')\n            .selectAll('.legend-item')\n            .data(stepLegendItems); // for smooth data updation\n\n          stepLegend.enter().append('div')\n            .attr('class', 'legend-item')\n            .styles({\n              display: 'flex',\n              'align-items': 'center',\n            })\n            .html((d, i) => {\n              const stepSize = (stripheight) / stepLegendItems.length;\n              return `<span style=\"width:${8}px; height:${((+d.key) + 1) * stepSize}px; background:transparent; border: 0.5px solid #333333;\"></span><p style=\"margin:0 0 0 0.5rem;\">${d.value}</p>`;\n            })\n            .merge(stepLegend)\n            .styles({\n              display: 'flex',\n              'align-items': 'center',\n            })\n            .html((d, i) => {\n              const stepSize = (stripheight) / stepLegendItems.length;\n              return `<span style=\"width:${8}px; height:${((+d.key) + 1) * stepSize}px; background:transparent; border: 0.5px solid #333333;\"></span><p style=\"margin:0 0 0 0.5rem;\">${d.value}</p>`;\n            });\n\n          stepLegend.exit()\n            .transition(transition)\n            .remove();\n        }\n      }\n      return this;\n    }\n}\n// console.log(this.defaultProps);\nexport default CountryLockdownIndicatorStrips;\n"]},"metadata":{},"sourceType":"module"}