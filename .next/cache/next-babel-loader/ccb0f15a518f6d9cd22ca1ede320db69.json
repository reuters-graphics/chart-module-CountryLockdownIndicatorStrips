{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport ChartComponent from './base/ChartComponent';\nimport d3 from './utils/d3';\nimport defaultData from './defaultData.json'; // see docs on https://github.com/reuters-graphics/graphics-atlas-client\n\nimport AtlasMetadataClient from '@reuters-graphics/graphics-atlas-client';\nvar atlastClient = new AtlasMetadataClient();\nvar dateParse = d3.timeParse(\"%Y-%m-%d\");\nvar dateFormat = d3.timeFormat(\"%b %e\");\nvar dateFormat_tt = d3.timeFormat(\"%B %e\");\nvar numberFormat_tt = d3.format(\",\");\n\nvar CountryLockdownIndicatorStrips = /*#__PURE__*/function (_ChartComponent) {\n  _inherits(CountryLockdownIndicatorStrips, _ChartComponent);\n\n  var _super = _createSuper(CountryLockdownIndicatorStrips);\n\n  function CountryLockdownIndicatorStrips() {\n    var _this;\n\n    _classCallCheck(this, CountryLockdownIndicatorStrips);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"defaultProps\", {\n      locale: 'en',\n      countryISO2: 'IN',\n      dataParams: {\n        date: 'date',\n        index: 'c1',\n        steps: 2,\n        // stepValue = 0, 1...\n        stepValue: 'flag'\n      },\n      height: 200,\n      margin: {\n        top: 10,\n        right: 10,\n        bottom: 10,\n        left: 10\n      },\n      valign: 'center',\n      // start, center, baseline\n      stripColor: {\n        0: '#ECEFF4',\n        1: '#d1eeea',\n        2: '#ffe47f',\n        3: '#a50f15'\n      },\n      baseColor: '#ECEFF4'\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"defaultData\", defaultData);\n\n    return _this;\n  }\n\n  _createClass(CountryLockdownIndicatorStrips, [{\n    key: \"draw\",\n    value: function draw() {\n      var data = this.data();\n      var props = this.props();\n      var node = this.selection().node(); // get country details from AtlasClient from ISO-2\n\n      props.country = atlastClient.getCountry(props.countryISO2);\n\n      var _node$getBoundingClie = node.getBoundingClientRect(),\n          width = _node$getBoundingClie.width;\n\n      var transition = d3.transition().duration(750); // main chart container\n\n      var chartDiv = this.selection().appendSelect('div') // see docs in ./utils/d3.js\n      .attr('class', 'CountryLockdownIndicatorStrips').style('width', \"\".concat(width, \"px\")).style('height', \"\".concat(props.height, \"px\")).appendSelect('div').style('transform', \"translate(\".concat(props.margin.left, \"px, \").concat(props.margin.top, \"px)\")); // set scales\n\n      var yScale = d3.scaleLinear().domain([0, props.dataParams.steps - 1]).range([props.height - props.margin.bottom, props.margin.top]);\n      var xScale = d3.scaleBand().domain(data.map(function (d) {\n        return dateParse(d[props.dataParams.date]);\n      })).range([props.margin.left, width - props.margin.right]).padding(0); // make bars\n\n      var bars = chartDiv.appendSelect('div.bars-container').style('display', 'flex').style('align-items', \"\".concat(props.valign)).selectAll('.bar').data(data, function (d, i) {\n        return d[props.dataParams.date];\n      }); // for smooth data updation\n\n      bars.enter().append('div').attr('class', function (d) {\n        return \"bar \".concat(d[props.dataParams.date]);\n      }).style('height', function (d) {\n        var stepSize = (props.height - props.margin.top - props.margin.bottom) / props.dataParams.steps;\n        var step = d[props.dataParams.stepValue] + 1;\n        return d[props.dataParams.index] ? step ? step * stepSize + 'px' : stepSize + 'px' : stepSize + 'px';\n      }).style('width', xScale.bandwidth() + 'px').style('display', 'inline-block').style('background', props.baseColor); // const circles = g.selectAll('circle')\n      //   .data(data, (d, i) => d[props.dataParams.date]);\n      // circles\n      //   .style('fill', props.fill)\n      //   .style('stroke', props.stroke);\n      // circles.enter().append('circle')\n      //   .style('fill', props.fill)\n      //   .style('stroke', props.stroke)\n      //   .style('stroke-width', props.strokeWidth)\n      //   .attr('cy', props.height / 2)\n      //   .attr('cx', (d, i) =>\n      //     data.slice(0, i).reduce((a, b) => a + b, 0) + (d / 2)\n      //   )\n      //   .merge(circles)\n      //   .transition(transition)\n      //   .attr('cx', (d, i) =>\n      //     data.slice(0, i).reduce((a, b) => a + b, 0) + (d / 2)\n      //   )\n      //   .attr('r', d => d / 2);\n      // circles.exit()\n      //   .transition(transition)\n      //   .attr('r', 0)\n      //   .remove();\n\n      return this;\n    }\n  }]);\n\n  return CountryLockdownIndicatorStrips;\n}(ChartComponent); // console.log(this.defaultProps);\n\n\nexport default CountryLockdownIndicatorStrips;","map":{"version":3,"sources":["/Users/prasanta/ReutersWork/INTERACTIVES/COVID-APP/chart-module-CountryLockdownIndicatorStrips/src/lib/chart.js"],"names":["ChartComponent","d3","defaultData","AtlasMetadataClient","atlastClient","dateParse","timeParse","dateFormat","timeFormat","dateFormat_tt","numberFormat_tt","format","CountryLockdownIndicatorStrips","locale","countryISO2","dataParams","date","index","steps","stepValue","height","margin","top","right","bottom","left","valign","stripColor","baseColor","data","props","node","selection","country","getCountry","getBoundingClientRect","width","transition","duration","chartDiv","appendSelect","attr","style","yScale","scaleLinear","domain","range","xScale","scaleBand","map","d","padding","bars","selectAll","i","enter","append","stepSize","step","bandwidth"],"mappings":"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","sourcesContent":["import ChartComponent from './base/ChartComponent';\nimport d3 from './utils/d3';\nimport defaultData from './defaultData.json';\n\n// see docs on https://github.com/reuters-graphics/graphics-atlas-client\nimport AtlasMetadataClient from '@reuters-graphics/graphics-atlas-client';\nconst atlastClient = new AtlasMetadataClient();\n\nconst dateParse = d3.timeParse(\"%Y-%m-%d\");\nconst dateFormat = d3.timeFormat(\"%b %e\");\nconst dateFormat_tt = d3.timeFormat(\"%B %e\");\nconst numberFormat_tt = d3.format(\",\");\n\nclass CountryLockdownIndicatorStrips extends ChartComponent {\n  defaultProps = {\n    locale: 'en',\n    countryISO2: 'IN',\n    dataParams: {\n      date: 'date',\n      index: 'c1',\n      steps: 2, // stepValue = 0, 1...\n      stepValue: 'flag'\n    },\n    height: 200,\n    margin: {\n      top: 10,\n      right: 10,\n      bottom: 10,\n      left: 10\n    },\n    valign: 'center', // start, center, baseline\n    stripColor: {0:'#ECEFF4', 1: '#d1eeea', 2: '#ffe47f',3:'#a50f15' },\n    baseColor: '#ECEFF4',\n\n  };\n\n  defaultData = defaultData;\n\n\n\n  draw() {\n    const data = this.data();\n    const props = this.props();\n    const node = this.selection().node();\n\n    // get country details from AtlasClient from ISO-2\n    props.country = atlastClient.getCountry(props.countryISO2);\n\n    const {\n      width\n    } = node.getBoundingClientRect();\n\n    const transition = d3.transition()\n      .duration(750);\n\n    // main chart container\n    const chartDiv = this.selection()\n      .appendSelect('div') // see docs in ./utils/d3.js\n      .attr('class','CountryLockdownIndicatorStrips')\n      .style('width', `${width}px`)\n      .style('height', `${props.height}px`)\n      .appendSelect('div')\n      .style('transform', `translate(${props.margin.left}px, ${props.margin.top}px)`);\n\n    // set scales\n    const yScale = d3.scaleLinear()\n      .domain([0, props.dataParams.steps - 1])\n      .range([props.height - props.margin.bottom, props.margin.top]);\n\n    const xScale = d3.scaleBand()\n      .domain(data.map(d => dateParse(d[props.dataParams.date])))\n      .range([props.margin.left, width - props.margin.right])\n      .padding(0);\n\n    // make bars\n    const bars = chartDiv.appendSelect('div.bars-container')\n      .style('display','flex')\n      .style('align-items',`${props.valign}`)\n      .selectAll('.bar')\n      .data(data, (d, i) => d[props.dataParams.date]); // for smooth data updation\n\n    bars.enter().append('div')\n      .attr('class', d => `bar ${d[props.dataParams.date]}`)\n      .style('height', d => {\n        let stepSize = (props.height - props.margin.top - props.margin.bottom) / props.dataParams.steps;\n        let step = d[props.dataParams.stepValue] + 1;\n        return d[props.dataParams.index] ? (step ? step * stepSize + 'px' : stepSize + 'px') : stepSize + 'px';\n      })\n      .style('width', xScale.bandwidth() + 'px')\n      .style('display', 'inline-block')\n      .style('background', props.baseColor);\n\n\n    // const circles = g.selectAll('circle')\n    //   .data(data, (d, i) => d[props.dataParams.date]);\n\n    // circles\n    //   .style('fill', props.fill)\n    //   .style('stroke', props.stroke);\n\n    // circles.enter().append('circle')\n    //   .style('fill', props.fill)\n    //   .style('stroke', props.stroke)\n    //   .style('stroke-width', props.strokeWidth)\n    //   .attr('cy', props.height / 2)\n    //   .attr('cx', (d, i) =>\n    //     data.slice(0, i).reduce((a, b) => a + b, 0) + (d / 2)\n    //   )\n    //   .merge(circles)\n    //   .transition(transition)\n    //   .attr('cx', (d, i) =>\n    //     data.slice(0, i).reduce((a, b) => a + b, 0) + (d / 2)\n    //   )\n    //   .attr('r', d => d / 2);\n\n    // circles.exit()\n    //   .transition(transition)\n    //   .attr('r', 0)\n    //   .remove();\n\n    return this;\n  }\n}\n// console.log(this.defaultProps);\nexport default CountryLockdownIndicatorStrips;"]},"metadata":{},"sourceType":"module"}